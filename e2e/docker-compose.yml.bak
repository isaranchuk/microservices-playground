version: '3'

services:
  orders:
    image: orders:latest
    depends_on:
      - orders-db
      - phones
    restart: on-failure
    environment:
      - PHONES_BASE_URL=http://phones:8080
    ports:
     - "9090:9090"

  phones:
    image: phones:latest
    depends_on:
      - phones-db
    restart: on-failure
    environment:
      - DB_HOST=phones-db
    ports:
     - "8080:8080"

  phones-db:
    image: phones-db:latest
    environment:
      - MYSQL_ROOT_PASSWORD=root
    ports:
     - "3306:3306"

  orders-db:
    image: mongo:4
    depends_on:
      - phones
    expose:
      -27017
    environment:
      - MONGO_INITDB_ROOT_USERNAME=root
      - MONGO_INITDB_ROOT_PASSWORD=root
      - MONGO_INITDB_DATABASE=orders
    ports:
     - "27017:27017"
